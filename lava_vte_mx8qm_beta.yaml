metadata:
    format: Lava-Test Test 
    name: alpha_vte_test 
    description: "i.MX8QM Beta VTE test"
    maintainer:
    os:
        - Linux
    scope:
        - functional
    devices:
        - imx8qm-arm2-lpddr4
install:
    git-repos:
        - https://github.com/eslover/sandbox-test
run:
    steps:
        - lava-test-case TGE-LV-OTP-0001 --shell ./scripts/lava-vte.sh 'otp_test.sh'
        - lava-test-case TGE-LV-USB-OTG-0069 --shell ./scripts/lava-vte.sh 'mount | grep -i gadgetfs && umount /dev/gadget; mkdir -p /dev/gadget && mount -t gadgetfs gadgetfs /dev/gadget && [ -e /dev/gadget/*usb ]'
        - lava-test-case TGE-LV-APP-0001 --shell ./scripts/lava-vte.sh 'gst-inspect-1.0'
        - lava-test-case TGE-LV-I2C-CLK-0001 --shell ./scripts/lava-vte.sh 'clk.sh i2c'
        - lava-test-case TGE-LV-CORE-0001 --shell ./scripts/lava-vte.sh 'validate'
        - lava-test-case TGE-LV-CORE-0002 --shell ./scripts/lava-vte.sh 'check_events'
        - lava-test-case TGE-LV-ETHERNET-1003 --shell ./scripts/lava-vte.sh 'ethtool eth0 && ifconfig eth0 | grep "dropped:0" && ifconfig eth0 | grep "overruns:0"'
        - lava-test-case TGE-LV-ETHERNET-1007 --shell ./scripts/lava-vte.sh 'touch readme && ftpget -u anonymous 10.193.101.65 readme readme && cat readme | grep welcome && rm readme'
        - lava-test-case TGE-LV-ETHERNET-1000 --shell ./scripts/lava-vte.sh 'ifaces=$(ifconfig -a|grep eth|awk '"'"'{print $1}'"'"');for eth in $ifaces; do ethstatus=$(ifconfig $eth | grep "RUNNING"); if [ -n "$ethstatus" ] ;then tcpdump -c 10 -i $eth;fi;done'
        - lava-test-case TGE-LV-ETHERNET-1008 --shell ./scripts/lava-vte.sh 'ethtool eth0 | grep 1000 ||ethtool eth1 | grep 1000'
        - lava-test-case TGE-LV-ETHERNET-1009 --shell ./scripts/lava-vte.sh 'ifconfig eth0 | grep "dropped:0"'
        - lava-test-case TGE-LV-ETHERNET-1011 --shell ./scripts/lava-vte.sh 'ifconfig eth0 | grep "overruns:0"'
        - lava-test-case TGE-LV-FEC-0010 --shell ./scripts/lava-vte.sh 'fec_testapp -T 0'
        - lava-test-case TGE-LV-FEC-0011 --shell ./scripts/lava-vte.sh 'if [ "`platfm.sh`" != "IMX6SX-SABREAUTO" ]; then if ifconfig |grep 10.200; then fec_testapp -T 1 -H 10.200.1.1; else fec_testapp -T 1 -H 10.192.130.201; fi; else if ifconfig |grep 10.200; then fec_testapp -T 1 -H 10.200.1.1 -D eth1; else fec_testapp -T 1 -H 10.192.130.201 -D eth1; fi; fi'
        - lava-test-case TGE-LV-FB-1003 --shell ./scripts/lava-vte.sh 'cat /dev/vcs'
        - lava-test-case TGE-LV-FB-1006 --shell ./scripts/lava-vte.sh 'RC=0;for i in $(find /sys/class/graphics/ -name fb[0-9]* );do echo 0 > ${i}/blank || RC=1; echo 1 > ${i}/blank || RC=1;done;echo 0 > /sys/class/graphics/fb0/blank;[ $RC -eq 0 ]'
        - lava-test-case TGE-LV-FB-1019 --shell ./scripts/lava-vte.sh 'echo 1 > /sys/class/graphics/fb0/rotate && echo q | fbv ${LTPROOT}/testcases/bin/butterfly.png'
        - lava-test-case TGE-LV-GPT-0010 --shell ./scripts/lava-vte.sh 'gpt_testapp'
        - lava-test-case TGE-LV-HRT-0020 --shell ./scripts/lava-vte.sh 'insmod ${LTPROOT}/testcases/bin/hrtimer_test.ko && sleep 1 && rmmod hrtimer_test && dmesg | grep hrtimer_callback'
        - lava-test-case TGE-LV-TIMER-FREQ-0001 --shell ./scripts/lava-vte.sh 'timer_interrupt'
        - lava-test-case TGE-LV-KMEM-0001 --shell ./scripts/lava-vte.sh 'insmod ${LTPROOT}/testcases/bin/memory_test.ko && rmmod memory_test'
        - lava-test-case TGE-LV-KERNEL-CLOCK-0001 --shell ./scripts/lava-vte.sh 'count=`cat /proc/timer_list | grep clock | wc -l`; [ $count -gt 0 ]'
        - lava-test-case TGE-LV-KERNEL-SMP-0002 --shell ./scripts/lava-vte.sh '[ $(cat /proc/cpuinfo | grep processor | wc -l ) -eq 4 ]'
        - lava-test-case TGE-LV-KERNEL-SMP-0009 --shell ./scripts/lava-vte.sh 'smp_test.sh 4'
        - lava-test-case TGE-LV-ALSA-0160a --shell ./scripts/lava-vte.sh 'amixer sget "Headphone"'
        - lava-test-case TGE-LV-ALSA-3005 --shell ./scripts/lava-vte.sh 'clk.sh audio'
        - lava-test-case TGE-LV-ALSA-0302 --shell ./scripts/lava-vte.sh 'bash -c "aplay -N -M /mnt/nfs/test_stream/alsa_stream/audio*.wav"'
        - lava-test-case TGE-LV-KERNEL-SMP-0004 --shell ./scripts/lava-vte.sh 'dmesg| grep -Ei "WARNING|error|cut here|end trace|oops|exception|fail|duplicate" > boot_maxcpus1_error.log; [ `cat /proc/cpuinfo |grep processor|wc -l` -eq 1 ] && log_check.sh 1 boot_maxcpus1_error.log $LTPROOT/testcases/bin/core_rules.txt'
        - lava-test-case TGE-LV-FB-8003 --shell ./scripts/lava-vte.sh 'dd if=/dev/urandom of=/dev/fb0 bs=1K count=5K'
        - lava-test-case TGE-LV-MEM-0010 --shell ./scripts/lava-vte.sh 'insmod ${LTPROOT}/testcases/bin/cma_test.ko && echo 0 > /dev/cma_test && echo 0 > /dev/cma_test && cat /dev/cma_test && echo 0 > /dev/cma_test && cat /dev/cma_test && cat /dev/cma_test && rmmod cma_test'
        - lava-test-case TGE-LV-RTC-0010 --shell ./scripts/lava-vte.sh 'rtc_testapp_1'
        - lava-test-case TGE-LV-RTC-0100 --shell ./scripts/lava-vte.sh 'rtc_test.sh 2'
        - lava-test-case TGE-LV-RTC-0020 --shell ./scripts/lava-vte.sh 'rtc_testapp_4'
        - lava-test-case TGE-LV-RTC-0011 --shell ./scripts/lava-vte.sh 'rtc_testapp_2'
        - lava-test-case TGE-LV-RTC-0013 --shell ./scripts/lava-vte.sh 'rtc_testapp_5 -T POLL'
        - lava-test-case TGE-LV-RTC-2000_H --shell ./scripts/lava-vte.sh 'rtc_test.sh 3'

parse:
    pattern: "[ a-zA-Z]+ (?P<test_case_id>[a-zA-Z0-9]+):\\s(?P<result>PASS|FAIL|SKIP)"
