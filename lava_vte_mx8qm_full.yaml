metadata:
    format: Lava-Test Test 
    name: lava_vte_test 
    description: "i.MX8XP VTE test"
    maintainer:
    os:
        - Linux
    scope:
        - functional
    devices:
        - imx8qxp-mek
install:
    git-repos:
        - https://github.com/eslover/sandbox-test
run:
    steps:
        #- lava-test-case TGE-LV-RTC-0010 --shell ./scripts/lava-vte.sh 'rtc_testapp_1'
        #- lava-test-case TGE-LV-RTC-0100 --shell ./scripts/lava-vte.sh 'rtc_test.sh 2'
        - lava-test-case LAVA-TEST-GPU-001 --shell ./scripts/gpu_auto/auto_test.sh
        - lava-test-case TGE-LV-eMMC-STORAGE-3000 --shell ./scripts/lava-vte.sh 'storage_all.sh 14'
        - lava-test-case TGE-LV-I2C-CLK-0001 --shell ./scripts/lava-vte.sh 'clk.sh i2c'
        - lava-test-case TGE-LV-BENCH-10001 --shell ./scripts/lava-vte.sh 'coremark_F4.exe 0x0 0x0 0x66 0 7 1 2000 && coremark_F4.exe 0x3415 0x3415 0x66 0 7 1 2000 && coremark_F4.exe 8 8 8 0 7 1 1200'
        - lava-test-case TGE-LV-BENCH-10002 --shell ./scripts/lava-vte.sh 'coremark_P4.exe 0x0 0x0 0x66 0 7 1 2000 && coremark_P4.exe 0x3415 0x3415 0x66 0 7 1 2000 && coremark_P4.exe 8 8 8 0 7 1 1200'
        - lava-test-case TGE-LV-KERNEL-SMP-0009 --shell ./scripts/lava-vte.sh 'smp_test.sh 4'
        #- lava-test-case TGE-LV-RTC-0020 --shell ./scripts/lava-vte.sh 'rtc_testapp_4'
        #- lava-test-case TGE-LV-RTC-0011 --shell ./scripts/lava-vte.sh 'rtc_testapp_2'
        #- lava-test-case TGE-LV-RTC-0013 --shell ./scripts/lava-vte.sh 'rtc_testapp_5 -T POLL'
        #- lava-test-case TGE-LV-RTC-0102 --shell ./scripts/lava-vte.sh 'rtc_test_7.sh'
        - lava-test-case TGE-LV-GPT-0010 --shell ./scripts/lava-vte.sh 'gpt_testapp'
        - lava-test-case TGE-LV-CORE-0001 --shell ./scripts/lava-vte.sh 'validate'
        - lava-test-case TGE-LV-ETHERNET-1009 --shell ./scripts/lava-vte.sh 'ifconfig eth0 | grep "dropped:0"'
        - lava-test-case TGE-LV-ETHERNET-1011 --shell ./scripts/lava-vte.sh 'ifconfig eth0 | grep "overruns:0"'
        - lava-test-case TGE-LV-TIMER-FREQ-0001 --shell ./scripts/lava-vte.sh 'timer_interrupt'
        - lava-test-case TGE-LV-ETHERNET-1008 --shell ./scripts/lava-vte.sh 'ethtool eth0 | grep 1000 ||ethtool eth1 | grep 1000'
        - lava-test-case TGE-LV-APP-0001 --shell ./scripts/lava-vte.sh 'gst-inspect-1.0'
        - lava-test-case TGE-LV-CORE-0002 --shell ./scripts/lava-vte.sh 'check_events'
        - lava-test-case TGE-LV-ETHERNET-1003 --shell ./scripts/lava-vte.sh 'ethtool eth0 && ifconfig eth0 | grep "dropped:0" && ifconfig eth0 | grep "overruns:0"'
        - lava-test-case TGE-LV-KERNEL-SMP-0002 --shell ./scripts/lava-vte.sh '[ $(cat /proc/cpuinfo | grep processor | wc -l ) -eq 4 ]'
        - lava-test-case TGE-LV-KERNEL-CLOCK-0001 --shell ./scripts/lava-vte.sh 'count=`cat /proc/timer_list | grep clock | wc -l`; [ $count -gt 0 ]'
        - lava-test-case TGE-LV-FEC-0010 --shell ./scripts/lava-vte.sh 'fec_testapp -T 0'
        - lava-test-case TGE-LV-SD-1050 --shell ./scripts/lava-vte.sh 'clk.sh sd'
        - lava-test-case TGE-LV-SD-1010 --shell ./scripts/lava-vte.sh 'mmc_transfer.sh'
        - lava-test-case TGE-LV-THERMO-0001 --shell ./scripts/lava-vte.sh 'RC=0;find /sys/devices/virtual/thermal -name "*temp";rt=$?;if [ $rt -eq 0 ];then ls /sys/devices/virtual/thermal/thermal_zone0/*temp | xargs cat && RC=0;else echo "No thermal interface found, so this chip maybe no thermal calibration, please check!";RC=1;fi;[ $RC -eq 0 ]'
        - lava-test-case TGE-LV-THERMO-0002 --shell ./scripts/lava-vte.sh 'RC=0;find /sys/devices/virtual/thermal -name "*_type";rt=$?;if [ $rt -eq 0 ];then ls /sys/devices/virtual/thermal/thermal_zone0/*_type | xargs cat && RC=0;else echo "No thermal interface found, so this chip maybe no thermal calibration, please check!";RC=1;fi;[ $RC -eq 0 ]'
        - lava-test-case TGE-LV-VPU-CLOCK-0001 --shell ./scripts/lava-vte.sh 'clk.sh vpu'
        - lava-test-case TGE-LV-DVFS-0200 --shell ./scripts/lava-vte.sh 'cpufreq-info'
        - lava-test-case TGE-LV-ETHERNET-1000 --shell ./scripts/lava-vte.sh 'ifaces=$(ifconfig -a|grep eth|awk '"'"'{print $1}'"'"');for eth in $ifaces; do ethstatus=$(ifconfig $eth | grep "RUNNING"); if [ -n "$ethstatus" ] ;then tcpdump -c 10 -i $eth;fi;done'
        - lava-test-case TGE-LV-KERNEL-10004 --shell ./scripts/lava-vte.sh 'tickless_timer "3:" 250'
        - lava-test-case TGE-LV-ETHERNET-1702 --shell ./scripts/lava-vte.sh 'ifconfig eth0 | grep "BROADCAST" | grep "MULTICAST"'
        - lava-test-case TGE-LV-ASRC-0201 --shell ./scripts/lava-vte.sh 'asrc_test1.sh -to 48000 $STREAM_PATH/asrc_stream/audio8k16S.wav && asrc_test1.sh -to 48000 $STREAM_PATH/asrc_stream/audio8k24S-S24_LE.wav'
        - lava-test-case TGE-LV-ASRC-0202 --shell ./scripts/lava-vte.sh 'asrc_test1.sh -to 96000 $STREAM_PATH/asrc_stream/audio48k16S.wav && asrc_test1.sh -to 96000 $STREAM_PATH/asrc_stream/audio48k24S-S24_LE.wav'
        - lava-test-case TGE-LV-ASRC-0203 --shell ./scripts/lava-vte.sh 'asrc_test1.sh -to 88200 $STREAM_PATH/asrc_stream/audio96k16S.wav && asrc_test1.sh -to 88200 $STREAM_PATH/asrc_stream/audio96k24S-S24_LE.wav'
        - lava-test-case TGE-LV-ASRC-0204 --shell ./scripts/lava-vte.sh 'asrc_test1.sh -to 44100 $STREAM_PATH/asrc_stream/audio88k16S.wav && asrc_test1.sh -to 44100 $STREAM_PATH/asrc_stream/audio88k24S-S24_LE.wav'
        - lava-test-case TGE-LV-ASRC-0210 --shell ./scripts/lava-vte.sh 'asrc_test1.sh -to 96000 $STREAM_PATH/asrc_stream/audio48k24S-S24_LE.wav'
        #- lava-test-case TGE-LV-THERMO-0006 --shell ./scripts/lava-vte.sh 'RC=0;find /sys/devices/virtual/thermal -name "*temp";rt=$?;if [ $rt -eq 0 ];then ls /sys/devices/virtual/thermal/thermal_zone0/*temp | xargs cat && rtc_testapp_6 -T 20 && ls /sys/devices/virtual/thermal/thermal_zone0/*temp | xargs cat && RC=0;else echo "No thermal interface found, so this chip maybe no thermal calibration, please check!";RC=1;fi;[ $RC -eq 0 ]'
        - lava-test-case TGE-LV-I2C-0001 --shell ./scripts/lava-vte.sh 'i=0; num=`i2cdetect -l | wc -l`;while [ $i -lt $num ]; do i2cdetect -y -a -r $i; i=`expr $i + 1`; done'
        - lava-test-case TGE-LV-FEC-0012 --shell ./scripts/lava-vte.sh 'if [ "`platfm.sh`" = "IMX6SX-SABREAUTO" ]; then fec_testapp -T 2 -D eth1; else fec_testapp -T 2; fi'
        - lava-test-case TGE-LV-KERNEL-10002 --shell ./scripts/lava-vte.sh 'timer_resolution'
        - lava-test-case TGE-LV-ASRC-0205 --shell ./scripts/lava-vte.sh 'asrc_grp_conv.sh 44'
        - lava-test-case TGE-LV-ASRC-0206 --shell ./scripts/lava-vte.sh 'asrc_grp_conv.sh 32'
        - lava-test-case TGE-LV-ASRC-0207 --shell ./scripts/lava-vte.sh 'asrc_grp_conv.sh 48'
        - lava-test-case TGE-LV-ASRC-0208 --shell ./scripts/lava-vte.sh 'asrc_grp_conv.sh 96'
        - lava-test-case TGE-LV-ASRC-0209 --shell ./scripts/lava-vte.sh 'asrc_grp_conv.sh 192'
        - lava-test-case TGE-LV-ASRC-0225 --shell ./scripts/lava-vte.sh 'asrc_grp_conv.sh ext 8'
        - lava-test-case TGE-LV-ASRC-0226 --shell ./scripts/lava-vte.sh 'asrc_grp_conv.sh ext 11'
        - lava-test-case TGE-LV-ASRC-0227 --shell ./scripts/lava-vte.sh 'asrc_grp_conv.sh ext 16'
        - lava-test-case TGE-LV-ASRC-0228 --shell ./scripts/lava-vte.sh 'asrc_grp_conv.sh ext 22'
        - lava-test-case TGE-LV-ASRC-0229 --shell ./scripts/lava-vte.sh 'asrc_grp_conv.sh ext 64'
        - lava-test-case TGE-LV-ASRC-0230 --shell ./scripts/lava-vte.sh 'asrc_grp_conv.sh ext 88'
        - lava-test-case TGE-LV-ASRC-0232 --shell ./scripts/lava-vte.sh 'asrc_grp_conv.sh ext 192'
        #- lava-test-case TGE-LV-ETHERNET-1701 --shell ./scripts/lava-vte.sh 'ethtool -s eth0 autoneg off speed 10 duplex full;ethtool eth0 | grep 10;ethtool -s eth0 autoneg off speed 100 duplex full;ethtool eth0 | grep 100'
        - lava-test-case TGE-LV-ASRC-0231 --shell ./scripts/lava-vte.sh 'asrc_grp_conv.sh ext 176'
        - lava-test-case TGE-LV-SD-1800 --shell ./scripts/lava-vte.sh 'storage_all.sh 10'
        - lava-test-case TGE-LV-STORAGE-2002 --shell ./scripts/lava-vte.sh 'storage_all.sh 2'
        #- lava-test-case TGE-LV-RTC-2000 --shell ./scripts/lava-vte.sh 'rtc_test.sh 3'
        - lava-test-case TGE-LV-BENCH-10003 --shell ./scripts/lava-vte.sh 'c-ray.sh'
        #- lava-test-case TGE-LV-KERNEL-SMP-0006 --shell ./scripts/lava-vte.sh 'smp_test.sh 2'
        #- lava-test-case TGE-LV-KERNEL-SMP-0008 --shell ./scripts/lava-vte.sh 'smp_test.sh 3'
        #- lava-test-case TGE-LV-MEM-0321 --shell ./scripts/lava-vte.sh 'mem_concurrent.sh 2'
        - lava-test-case TGE-LV-MEM-0320 --shell ./scripts/lava-vte.sh 'testmem_k=$(expr `cat /proc/meminfo |grep MemTotal |awk '"'"'{print $2}'"'"'` / 20); time -p memtester ${testmem_k}K 1'

parse:
    pattern: "[ a-zA-Z]+ (?P<test_case_id>[a-zA-Z0-9]+):\\s(?P<result>PASS|FAIL|SKIP)"
