metadata:
    format: Lava-Test Test 
    name: alpha_vte_test 
    description: "i.MX8XP Alpha VTE test"
    maintainer:
    os:
        - Linux
    scope:
        - functional
    devices:
        - imx8qxp-mek
install:
    git-repos:
        - https://github.com/eslover/sandbox-test
run:
    steps:
        - lava-test-case TGE-LV-SYSTEST-0020 --shell ./scripts/lava-vte.sh 'coremark_F4.exe_arm32 0x0 0x0 0x66 0 7 1 2000 && memcpybm_arm32'
        - lava-test-case TGE-LV-I2C-0001 --shell ./scripts/lava-vte.sh 'i=0; num=`i2cdetect -l | wc -l`;while [ $i -lt $num ]; do i2cdetect -y -a -r $i; i=`expr $i + 1`; done'
        - lava-test-case TGE-LV-BENCH-10001 --shell ./scripts/lava-vte.sh 'coremark_F4.exe 0x0 0x0 0x66 0 7 1 2000 && coremark_F4.exe 0x3415 0x3415 0x66 0 7 1 2000 && coremark_F4.exe 8 8 8 0 7 1 1200'
        - lava-test-case TGE-LV-BENCH-10002 --shell ./scripts/lava-vte.sh 'coremark_P4.exe 0x0 0x0 0x66 0 7 1 2000 && coremark_P4.exe 0x3415 0x3415 0x66 0 7 1 2000 && coremark_P4.exe 8 8 8 0 7 1 1200'
        - lava-test-case TGE-LV-KERNEL-SMP-0009 --shell ./scripts/lava-vte.sh 'smp_test.sh 4'
        #- lava-test-case TGE-LV-RTC-0010 --shell ./scripts/lava-vte.sh 'rtc_testapp_1'
        #- lava-test-case TGE-LV-RTC-0020 --shell ./scripts/lava-vte.sh 'rtc_testapp_4'
        #- lava-test-case TGE-LV-RTC-0011 --shell ./scripts/lava-vte.sh 'rtc_testapp_2'
        #- lava-test-case TGE-LV-RTC-0013 --shell ./scripts/lava-vte.sh 'rtc_testapp_5 -T POLL'
        - lava-test-case TGE-LV-ESLCD-0600 --shell ./scripts/lava-vte.sh 'lcd_testapp_power -F /dev/fb0'
        - lava-test-case TGE-LV-GPT-0010 --shell ./scripts/lava-vte.sh 'gpt_testapp'
        - lava-test-case TGE-LV-ESLCD-0702 --shell ./scripts/lava-vte.sh 'dd if=/dev/urandom of=/dev/fb0 bs=1k count=150'
        - lava-test-case TGE-LV-FB-1003 --shell ./scripts/lava-vte.sh 'cat /dev/vcs'
        #- lava-test-case TGE-LV-RTC-2000 --shell ./scripts/lava-vte.sh 'rtc_test.sh 3'
        - lava-test-case TGE-LV-CORE-0001 --shell ./scripts/lava-vte.sh 'validate'
        - lava-test-case TGE-LV-ETHERNET-1009 --shell ./scripts/lava-vte.sh 'ifconfig eth0 | grep "dropped:0"'
        - lava-test-case TGE-LV-ETHERNET-1011 --shell ./scripts/lava-vte.sh 'ifconfig eth0 | grep "overruns:0"'
        - lava-test-case TGE-LV-FB-1019 --shell ./scripts/lava-vte.sh 'echo 1 > /sys/class/graphics/fb0/rotate && echo q | fbv ${LTPROOT}/testcases/bin/butterfly.png'
        - lava-test-case TGE-LV-TIMER-FREQ-0001 --shell ./scripts/lava-vte.sh 'timer_interrupt'
        - lava-test-case TGE-LV-ETHERNET-1008 --shell ./scripts/lava-vte.sh 'ethtool eth0 | grep 1000 ||ethtool eth1 | grep 1000'
        - lava-test-case TGE-LV-APP-0001 --shell ./scripts/lava-vte.sh 'gst-inspect-1.0'
        - lava-test-case TGE-LV-CORE-0002 --shell ./scripts/lava-vte.sh 'check_events'
        - lava-test-case TGE-LV-ETHERNET-1003 --shell ./scripts/lava-vte.sh 'ethtool eth0 && ifconfig eth0 | grep "dropped:0" && ifconfig eth0 | grep "overruns:0"'
        - lava-test-case TGE-LV-KERNEL-SMP-0002 --shell ./scripts/lava-vte.sh '[ $(cat /proc/cpuinfo | grep processor | wc -l ) -eq 4 ]'
        #- lava-test-case TGE-LV-RTC-0100 --shell ./scripts/lava-vte.sh 'rtc_test.sh 2'
        - lava-test-case TGE-LV-KERNEL-CLOCK-0001 --shell ./scripts/lava-vte.sh 'count=`cat /proc/timer_list | grep clock | wc -l`; [ $count -gt 0 ]'
        - lava-test-case TGE-LV-FEC-0012 --shell ./scripts/lava-vte.sh 'if [ "`platfm.sh`" = "IMX6SX-SABREAUTO" ]; then fec_testapp -T 2 -D eth1; else fec_testapp -T 2; fi'
        - lava-test-case TGE-LV-FEC-0010 --shell ./scripts/lava-vte.sh 'fec_testapp -T 0'
        - lava-test-case TGE-LV-KERNEL-10002 --shell ./scripts/lava-vte.sh 'timer_resolution'
        - lava-test-case TGE-LV-BENCH-10003 --shell ./scripts/lava-vte.sh 'c-ray.sh'
        #- lava-test-case TGE-LV-MEM-0321 --shell ./scripts/lava-vte.sh 'mem_concurrent.sh 2'
        - lava-test-case TGE-LV-FB-8003 --shell ./scripts/lava-vte.sh 'dd if=/dev/urandom of=/dev/fb0 bs=1K count=5K'
        - lava-test-case TGE-LV-FB-8004 --shell ./scripts/lava-vte.sh 'fbdep_def=$(fbset -fb /dev/fb0 | grep geometry | cut -d " " -f 10) && lcd_testapp -T 1 -B /dev/fb0 -D $fbdep_def -X 10'
        - lava-test-case TGE-LV-FB-8005 --shell ./scripts/lava-vte.sh 'fbdep_def=$(fbset -fb /dev/fb0 | grep geometry | cut -d " " -f 10) && lcd_testapp -T 1 -B /dev/fb0 -D $fbdep_def -X 10 -N 10'
        - lava-test-case TGE-LV-ETHERNET-1007 --shell ./scripts/lava-vte.sh 'touch readme && ftpget -u anonymous 10.193.101.65 readme readme && cat readme | grep welcome && rm readme'
        - lava-test-case TGE-LV-MEM-0320 --shell ./scripts/lava-vte.sh 'testmem_k=$(expr `cat /proc/meminfo |grep MemTotal |awk '"'"'{print $2}'"'"'` / 20); time -p memtester ${testmem_k}K 1'
        - lava-test-case TGE-LV-ESLCD-0704 --shell ./scripts/lava-vte.sh 'fbdep_def=$(fbset -fb /dev/fb0 | grep geometry | cut -d " " -f 10) && lcd_testapp -T 4 -B /dev/fb0 -D $fbdep_def'
        - lava-test-case TGE-LV-USB-HOST-0010 --shell ./scripts/lava-vte.sh 'get_scsi.sh usbs'
        - lava-test-case TGE-LV-ESLCD-0700 --shell ./scripts/lava-vte.sh 'fbdep_def=$(fbset -fb /dev/fb0 | grep geometry | cut -d " " -f 10) && fbset -depth 16 && lcd_testapp -T 1 -B /dev/fb0 -D 16 -X 10 && fbset -depth $fbdep_def'
        - lava-test-case TGE-LV-FB-1002 --shell ./scripts/lava-vte.sh 'fbset && fbdep_def=$(fbset -fb /dev/fb0 | grep geometry | cut -d " " -f 10) && fbset -depth 32 && fbset -depth 16 && fbset -depth 24 && fbset -depth 32 && fbset -depth $fbdep_def'
        #- lava-test-case TGE-LV-RTC-0102 --shell ./scripts/lava-vte.sh 'rtc_test_7.sh'
        - lava-test-case TGE-LV-FB-1006 --shell ./scripts/lava-vte.sh 'RC=0;for i in $(find /sys/class/graphics/ -name fb[0-9]* );do echo 0 > ${i}/blank || RC=1; echo 1 > ${i}/blank || RC=1;done;echo 0 > /sys/class/graphics/fb0/blank;[ $RC -eq 0 ]'
        - lava-test-case TGE-LV-FEC-0011 --shell ./scripts/lava-vte.sh 'if [ "`platfm.sh`" != "IMX6SX-SABREAUTO" ]; then if ifconfig |grep 10.200; then fec_testapp -T 1 -H 10.200.1.1; else fec_testapp -T 1 -H 10.192.130.201; fi; else if ifconfig |grep 10.200; then fec_testapp -T 1 -H 10.200.1.1 -D eth1; else fec_testapp -T 1 -H 10.192.130.201 -D eth1; fi; fi'
        - lava-test-case TGE-LV-ESLCD-0710 --shell ./scripts/lava-vte.sh 'fbdep_def=$(fbset -fb /dev/fb0 | grep geometry | cut -d " " -f 10) && fbset -depth 32 && lcd_testapp -T 2 -B /dev/fb0 -D 32 -X 10 && fbset -depth $fbdep_def'
        - lava-test-case TGE-LV-ESLCD-0161 --shell ./scripts/lava-vte.sh 'fbdep_def=$(fbset -fb /dev/fb0 | grep geometry | cut -d " " -f 10) && lcd_testapp -T 1 -B /dev/fb0 -D $fbdep_def -X 10 -N 10'
        - lava-test-case TGE-LV-SD-1010 --shell ./scripts/lava-vte.sh 'mmc_transfer.sh'
        #- lava-test-case TGE-LV-KERNEL-SMP-0005 --shell ./scripts/lava-vte.sh 'smp_test.sh 1'
        #- lava-test-case TGE-LV-KERNEL-SMP-0006 --shell ./scripts/lava-vte.sh 'smp_test.sh 2'
        - lava-test-case TGE-LV-DVFS-0200 --shell ./scripts/lava-vte.sh 'cpufreq-info'
        - lava-test-case TGE-LV-SD-1800 --shell ./scripts/lava-vte.sh '( mnt_p=`cat /proc/partitions | awk '"'"'{print $4}'"'"'| grep mmcblk| grep -vi "boot"| grep -vi "rpmb" | tail -n 1`; mmc_p=/dev/${mnt_p}; if [ ! -n $mmc_p ]; then echo "no avalible device to test"; exit 1; else umount $mmc_p; echo y | mkfs.ext3 $mmc_p; mkdir -p /mnt/mmc; mount -t ext3 $mmc_p /mnt/mmc; bonnie++ -d /mnt/mmc -u 0:0 -s 10 -r 5 && dt of=/mnt/mmc/test_file bs=4k limit=128m passes=20; fi; )'
        #- lava-test-case TGE-LV-KERNEL-BOOT-0001 --shell ./scripts/lava-vte.sh 'set_reboot.sh 1 && do_reboot.sh && dmesg| grep -Ei "WARNING|error|cut here|end trace|oops|exception|fail|duplicate|not found|can not|can'"'"'t" > boot_error.log; log_check.sh 1 boot_error.log $LTPROOT/testcases/bin/core_rules.txt; clr_handler.sh -p $? -t reboot'
        #- lava-test-case TGE-LV-EMMC-HS400-0001 --shell ./scripts/lava-vte.sh 'grep boot /proc/partitions && index=$(grep boot /proc/partitions |tail -n 1|awk '"'"'{print $4}'"'"'|sed -n '"'"'s/boot0//p'"'"' |sed -n '"'"'s/mmcblk//p'"'"') && cat /sys/kernel/debug/mmc${index}/ios |grep '"'"'200000000 Hz'"'"' && cat /sys/kernel/debug/mmc${index}/ios | grep -E '"'"'mmc high-speed DDR200|HS400'"'"' && cat /sys/kernel/debug/mmc${index}/ios |grep '"'"'1.80 V'"'"' && time -p dd if=/dev/mmcblk${index}p1 of=/dev/null bs=4096 count=256000 && time -p dd if=/dev/zero of=/dev/mmcblk${index}p1 bs=4096 count=256000 conv=fsync'
        - lava-test-case TGE-LV-FB-8002 --shell ./scripts/lava-vte.sh 'fb_mem -d /dev/fb0 -T 1'
        - lava-test-case TGE-LV-ETHERNET-1000 --shell ./scripts/lava-vte.sh 'ifaces=$(ifconfig -a|grep eth|awk '"'"'{print $1}'"'"');for eth in $ifaces; do ethstatus=$(ifconfig $eth | grep "RUNNING"); if [ -n "$ethstatus" ] ;then tcpdump -c 10 -i $eth;fi;done'
        - lava-test-case TGE-LV-FB-0031 --shell ./scripts/lava-vte.sh 'fbset && fbdep_def=$(fbset -fb /dev/fb0 | grep geometry | cut -d " " -f 10) && fbset -depth 32 && lcd_testapp -T 1 -D 32 -B /dev/fb0 -X 10 && fbset -depth $fbdep_def'
        - lava-test-case TGE-LV-FB-0010 --shell ./scripts/lava-vte.sh 'fbset && fbdep_def=$(fbset -fb /dev/fb0 | grep geometry | cut -d " " -f 10) && fbset -depth 16; lcd_testapp -T 1 -D 16 -B /dev/fb0 -X 10 && fbset -depth $fbdep_def'
        - lava-test-case TGE-LV-FB-8887 --shell ./scripts/lava-vte.sh 'fb_name="";fb_names=`cat /sys/class/graphics/fb0/name | grep -i '"'"'^[a-z]'"'"'`&& [ -z "${fb_names}" ]'
        #- lava-test-case TGE-LV-GPT-0011 --shell ./scripts/lava-vte.sh 'gpt_test_pm.sh 1'
        - lava-test-case TGE-LV-KERNEL-10004 --shell ./scripts/lava-vte.sh 'tickless_timer "3:" 250'
        #- lava-test-case TGE-LV-HDMI-0017 --shell ./scripts/lava-vte.sh 'res_req.sh HDMI && hdmi_test.sh cable_state && clr_handler.sh -p $? -t HDMI'
        #- lava-test-case TGE-LV-STORAGE-2001 --shell ./scripts/lava-vte.sh 'storage_all.sh 1'
        #- lava-test-case TGE-LV-STORAGE-2002 --shell ./scripts/lava-vte.sh 'storage_all.sh 2'

parse:
    pattern: "[ a-zA-Z]+ (?P<test_case_id>[a-zA-Z0-9]+):\\s(?P<result>PASS|FAIL|SKIP)"
